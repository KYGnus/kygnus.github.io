<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>IOC</title>
  <link rel="stylesheet" href="https://stackedit.io/style.css" />
</head>

<body class="stackedit">
  <div class="stackedit__html"><h1 id="malware-analyzing-tools">File IOC</h1>
<h2 id="file">File</h2>
<pre><code>file test.exe
</code></pre>
<h2 id="exiftools">ExifTools</h2>
<pre><code>exiftools test.exe
</code></pre>
<h2 id="md5sum">md5sum</h2>
<pre><code>md5sum test.exe
</code></pre>
<h2 id="sha256sum">sha256sum</h2>
<pre><code>sha256sum test.exe
</code></pre>
<h2 id="strings">strings</h2>
<pre><code>strintgs test.exe
</code></pre>
<h2 id="clamav">clamAV</h2>
<pre><code>sudo clamscan -v test.exe
</code></pre>
<pre><code>sudo freshclam      #Update rules
clamscan filepath   #Scan 1 file
clamscan folderpath #Scan the whole folder
</code></pre>
<h2 id="yara">yara</h2>
<pre><code>sudo apt-get install -y yara
</code></pre>
<blockquote>
<p>Use this script to download and merge all the yara malware rules from github: <a href="https://gist.github.com/andreafortuna/29c6ea48adf3d45a979a78763cdc7ce9">https://gist.github.com/andreafortuna/29c6ea48adf3d45a979a78763cdc7ce9</a><br>
Create the rules directory and execute it. This will create a file called malware_rules.yar which contains all the yara rules for malware.</p>
</blockquote>
<pre><code>wget https://gist.githubusercontent.com/andreafortuna/29c6ea48adf3d45a979a78763cdc7ce9/raw/4ec711d37f1b428b63bed1f786b26a0654aa2f31/malware_yara_rules.py
mkdir rules
python malware_yara_rules.py
</code></pre>
<p><strong>Scan</strong></p>
<pre><code>yara -w malware_rules.yar image  #Scan 1 file
yara -w malware_rules.yar folder #Scan the whole folder
</code></pre>
<h2 id="virustotal--vt-scanner">(VirusTotal ) vt-scanner</h2>
<pre><code>python vt-scanner.py test.exe
</code></pre>
<h2 id="sensitive-scripts">Sensitive Scripts</h2>
<h2 id="capa">capa</h2>
<blockquote>
<p>Capa detects potentially malicious capabilities in executables: PE, ELF, .NET. So it will find things such as Att&amp;ck tactics, or suspicious capabilities such as:</p>
</blockquote>
<ul>
<li>
<p>check for OutputDebugString error</p>
</li>
<li>
<p>run as a service</p>
</li>
<li>
<p>create process</p>
</li>
</ul>
<blockquote>
<p>Example of capa capabilities:</p>
</blockquote>
<ul>
<li>Persistence: Identifies if the binary tries to establish persistence on a system (e.g., by modifying the registry).</li>
<li>Networking: Detects if the malware attempts to communicate over a network, such as sending HTTP requests or opening sockets.</li>
<li>Encryption: Recognizes the use of encryption algorithms like AES or RC4.</li>
<li>File System Interaction: Tracks file creation, deletion, or modification activities.</li>
</ul>
<pre><code>capa test.exe
</code></pre>
<h3 id="more-information">More Information</h3>
<p>Here are some sample outputs and usage examples of <strong>capa</strong>, a tool used for analyzing executables (especially malware) by identifying their capabilities. These examples showcase the kind of information capa extracts when analyzing a file, including behavioral patterns, techniques, and malware capabilities.</p>
<h3 id="basic-capa-usage">1. <strong>Basic capa Usage</strong></h3>
<p>First, run <strong>capa</strong> on an executable file. For example:</p>
<pre class=" language-bash"><code class="prism  language-bash">capa malware_sample.exe
</code></pre>
<h3 id="sample-output">Sample Output:</h3>
<pre class=" language-bash"><code class="prism  language-bash">+------------------------+---------------------------------------------------------------------------------+
<span class="token operator">|</span> ATT<span class="token operator">&amp;</span>CK Tactic          <span class="token operator">|</span> ATT<span class="token operator">&amp;</span>CK Technique                                                                <span class="token operator">|</span>
<span class="token operator">|</span>------------------------+---------------------------------------------------------------------------------<span class="token operator">|</span>
<span class="token operator">|</span> DEFENSE EVASION        <span class="token operator">|</span> Obfuscated Files or Information <span class="token punctuation">[</span>T1027<span class="token punctuation">]</span>                                         <span class="token operator">|</span>
<span class="token operator">|</span> DISCOVERY              <span class="token operator">|</span> Query Registry <span class="token punctuation">[</span>T1012<span class="token punctuation">]</span>                                                          <span class="token operator">|</span>
<span class="token operator">|</span> DISCOVERY              <span class="token operator">|</span> Query Information from Local System <span class="token punctuation">[</span>T1082<span class="token punctuation">]</span>                                     <span class="token operator">|</span>
<span class="token operator">|</span> EXECUTION              <span class="token operator">|</span> Shared Modules <span class="token punctuation">[</span>T1129<span class="token punctuation">]</span>                                                          <span class="token operator">|</span>
+------------------------+---------------------------------------------------------------------------------+

+----------------------------+--------------------------------------------------------------------------+
<span class="token operator">|</span> MBC Objective               <span class="token operator">|</span> MBC Behavior                                                            <span class="token operator">|</span>
<span class="token operator">|</span>----------------------------+--------------------------------------------------------------------------<span class="token operator">|</span>
<span class="token operator">|</span> ANTI-BEHAVIORAL ANALYSIS    <span class="token operator">|</span> Obfuscate or Encrypt Code <span class="token punctuation">[</span>B0030.003<span class="token punctuation">]</span>                                    <span class="token operator">|</span>
<span class="token operator">|</span> DISCOVERY                   <span class="token operator">|</span> System Information Discovery <span class="token punctuation">[</span>F0022<span class="token punctuation">]</span>                                     <span class="token operator">|</span>
+----------------------------+--------------------------------------------------------------------------+

+------------------------------+------------------------------------------------------------------------+
<span class="token operator">|</span> CAPABILITY                    <span class="token operator">|</span> DESCRIPTION                                                           <span class="token operator">|</span>
<span class="token operator">|</span>------------------------------+------------------------------------------------------------------------<span class="token operator">|</span>
<span class="token operator">|</span> Allocate RWX memory           <span class="token operator">|</span> The sample allocates memory with Read, Write, and Execute permissions  <span class="token operator">|</span>
<span class="token operator">|</span> Get computer name             <span class="token operator">|</span> The sample retrieves the computer name of the system                   <span class="token operator">|</span>
<span class="token operator">|</span> Create a <span class="token function">file</span>                 <span class="token operator">|</span> The sample creates or opens a <span class="token function">file</span>                                     <span class="token operator">|</span>
<span class="token operator">|</span> Sleep <span class="token punctuation">(</span>anti-analysis<span class="token punctuation">)</span>         <span class="token operator">|</span> The sample uses the Sleep function, often used to evade sandboxing     <span class="token operator">|</span>
<span class="token operator">|</span> Use Windows API calls         <span class="token operator">|</span> The sample directly uses Windows API calls                             <span class="token operator">|</span>
+------------------------------+------------------------------------------------------------------------+

capa: finished analysis of malware_sample.exe
</code></pre>
<h3 id="example-capa-findings">2. <strong>Example capa Findings</strong></h3>
<p>Below is a breakdown of what the <strong>capa</strong> output might show, based on the capabilities of the analyzed binary.</p>
<h4 id="memory-manipulation"><strong>Memory Manipulation</strong>:</h4>
<ul>
<li><strong>Allocate RWX memory</strong>: This indicates that the malware sample is allocating memory with read, write, and execute permissions, a common technique in exploits or to inject malicious code.</li>
</ul>
<h4 id="file-manipulation"><strong>File Manipulation</strong>:</h4>
<ul>
<li><strong>Create a file</strong>: The malware creates or opens files, which could mean it’s writing data to disk, perhaps as part of a payload or for persistence.</li>
</ul>
<h4 id="system-discovery"><strong>System Discovery</strong>:</h4>
<ul>
<li><strong>Get computer name</strong>: The malware is querying the system for information about the computer, likely as part of reconnaissance to adjust its behavior based on the environment.</li>
</ul>
<h4 id="anti-analysis-techniques"><strong>Anti-Analysis Techniques</strong>:</h4>
<ul>
<li><strong>Sleep (anti-analysis)</strong>: The sample uses the <code>Sleep</code> function, a common technique to evade analysis by delaying execution and making it harder for sandbox environments to catch malicious behavior.</li>
</ul>
<h4 id="persistence-and-execution"><strong>Persistence and Execution</strong>:</h4>
<ul>
<li><strong>Use Windows API calls</strong>: The sample interacts directly with Windows API functions, a key method used for many forms of malware to carry out malicious activities like process injection, registry manipulation, or file access.</li>
</ul>
<h3 id="identifying-malware-capabilities">3. <strong>Identifying Malware Capabilities</strong></h3>
<p>Here’s another sample capa output that indicates more specific malware behaviors:</p>
<pre class=" language-bash"><code class="prism  language-bash">+------------------------------+--------------------------------------------------------------------------+
<span class="token operator">|</span> CAPABILITY                    <span class="token operator">|</span> DESCRIPTION                                                             <span class="token operator">|</span>
<span class="token operator">|</span>------------------------------+--------------------------------------------------------------------------<span class="token operator">|</span>
<span class="token operator">|</span> Read PE header                <span class="token operator">|</span> The malware reads the Portable Executable <span class="token punctuation">(</span>PE<span class="token punctuation">)</span> header of a <span class="token function">file</span>          <span class="token operator">|</span>
<span class="token operator">|</span> Query disk information        <span class="token operator">|</span> The malware queries disk information <span class="token punctuation">(</span>size, type, etc.<span class="token punctuation">)</span>                  <span class="token operator">|</span>
<span class="token operator">|</span> Encrypt data                  <span class="token operator">|</span> The malware performs data encryption, possibly to protect its payload    <span class="token operator">|</span>
<span class="token operator">|</span> Communicate using HTTP        <span class="token operator">|</span> The malware communicates over HTTP, potentially exfiltrating data        <span class="token operator">|</span>
<span class="token operator">|</span> Open process                  <span class="token operator">|</span> The malware opens a process, possibly <span class="token keyword">for</span> injection or manipulation      <span class="token operator">|</span>
<span class="token operator">|</span> Modify registry key           <span class="token operator">|</span> The malware modifies a registry key, likely <span class="token keyword">for</span> persistence or evasion   <span class="token operator">|</span>
+------------------------------+--------------------------------------------------------------------------+
</code></pre>
<h4 id="detailed-behavior"><strong>Detailed Behavior</strong>:</h4>
<ul>
<li><strong>Read PE header</strong>: This shows that the malware inspects other executables, perhaps for infection purposes or to check system files.</li>
<li><strong>Query disk information</strong>: The sample gathers information about the disk, potentially to detect virtualized environments or understand system configurations.</li>
<li><strong>Encrypt data</strong>: This indicates ransomware-like behavior where data is encrypted.</li>
<li><strong>Communicate using HTTP</strong>: The malware can communicate with remote servers using HTTP, possibly for exfiltrating stolen data or receiving commands.</li>
<li><strong>Open process</strong>: Opening a process might indicate process injection or other malicious actions on running processes.</li>
<li><strong>Modify registry key</strong>: Common in malware that establishes persistence on a victim machine, allowing it to run on startup.</li>
</ul>
<h3 id="running-capa-with-custom-yara-rules">4. <strong>Running capa with Custom YARA Rules</strong></h3>
<p>capa supports YARA rules for more customized detection. You can provide custom rules to extend capa’s detection capabilities.</p>
<p>Example command:</p>
<pre class=" language-bash"><code class="prism  language-bash">capa --rules /path/to/custom/rules malware_sample.exe
</code></pre>
<p>This will use your custom rules (in addition to capa’s standard rule set) to analyze the file for specific behaviors you’re looking for.</p>
<h3 id="detecting-specific-techniques-using-attck">5. <strong>Detecting Specific Techniques Using ATT&amp;CK</strong></h3>
<p>Another useful aspect of capa is its mapping to the <strong>MITRE ATT&amp;CK framework</strong>, which categorizes various techniques used by adversaries.</p>
<pre class=" language-bash"><code class="prism  language-bash">+------------------------+---------------------------------------------------+
<span class="token operator">|</span> ATT<span class="token operator">&amp;</span>CK Tactic          <span class="token operator">|</span> ATT<span class="token operator">&amp;</span>CK Technique                                  <span class="token operator">|</span>
<span class="token operator">|</span>------------------------+---------------------------------------------------<span class="token operator">|</span>
<span class="token operator">|</span> PERSISTENCE            <span class="token operator">|</span> Modify Registry <span class="token punctuation">[</span>T1112<span class="token punctuation">]</span>                           <span class="token operator">|</span>
<span class="token operator">|</span> EXECUTION              <span class="token operator">|</span> Command-Line Interface <span class="token punctuation">[</span>T1059<span class="token punctuation">]</span>                    <span class="token operator">|</span>
<span class="token operator">|</span> CREDENTIAL ACCESS      <span class="token operator">|</span> Credential Dumping <span class="token punctuation">[</span>T1003<span class="token punctuation">]</span>                        <span class="token operator">|</span>
<span class="token operator">|</span> DEFENSE EVASION        <span class="token operator">|</span> Obfuscated Files or Information <span class="token punctuation">[</span>T1027<span class="token punctuation">]</span>           <span class="token operator">|</span>
+------------------------+---------------------------------------------------+
</code></pre>
<h4 id="example-of-attck-techniques">Example of ATT&amp;CK Techniques:</h4>
<ul>
<li><strong>Modify Registry</strong>: The malware modifies the Windows registry to ensure it persists across reboots.</li>
<li><strong>Command-Line Interface</strong>: It uses the command-line for execution, indicating it may execute system commands as part of its operation.</li>
<li><strong>Credential Dumping</strong>: The sample could be trying to extract sensitive information like passwords or authentication tokens.</li>
<li><strong>Obfuscated Files</strong>: Indicates that the malware may be packed or obfuscated to hide its true intent from analysis tools.</li>
</ul>
<h2 id="loki">Loki</h2>
<blockquote>
<p>Loki is a scanner for Simple Indicators of Compromise.<br>
Detection is based on four detection methods:</p>
</blockquote>
<pre><code>1. File Name IOC
   Regex match on full file path/name

2. Yara Rule Check
   Yara signature matches on file data and process memory

3. Hash Check
   Compares known malicious hashes (MD5, SHA1, SHA256) with scanned files
   
4. C2 Back Connect Check
   Compares process connection endpoints with C2 IOCs (new since version v.10)


</code></pre>
<h2 id="floss">Floss</h2>
<p>is a tool that will try to find obfuscated strings inside executables using different techniques.<br>
The FLARE Obfuscated String Solver (FLOSS, formerly FireEye Labs Obfuscated String Solver) uses advanced static analysis techniques to automatically extract and deobfuscate all strings from malware binaries. You can use it just like strings.exe to enhance the basic static analysis of unknown binaries.</p>
<pre><code>floss malware.exe
</code></pre>
<blockquote>
<p>Only extract stack and tight strings:</p>
</blockquote>
<pre><code>floss --only stack tight -- suspicious.exe
</code></pre>
<blockquote>
<p>Do not extract static strings:</p>
</blockquote>
<pre><code>floss --no static -- backdoor.exe
</code></pre>
<blockquote>
<p>Display the help/usage screens:</p>
</blockquote>
<pre><code>floss -h  # show core arguments
floss -H  # show all supported arguments
</code></pre>
<p><a href="https://github.com/mandiant/flare-floss">Link</a></p>
<h2 id="iocs">IOCS</h2>
<p><strong>Simple Indicators of Compromise (IoCs)</strong> are data points or clues that suggest a system may be compromised or under attack by malware or other malicious activity. These indicators provide evidence of potential security breaches and are used by security teams to detect, investigate, and respond to cyber threats.</p>
<h3 id="examples-of-simple-iocs">Examples of Simple IoCs:</h3>
<ol>
<li>
<p><strong>File Names</strong>:</p>
<ul>
<li>Unusual or suspicious file names that match known malware patterns.</li>
<li>Example: A file named <code>evil.exe</code> or <code>msword_update.bat</code> may indicate the presence of malware.</li>
</ul>
</li>
<li>
<p><strong>File Hashes</strong>:</p>
<ul>
<li>Cryptographic hash values (e.g., MD5, SHA1, SHA256) of known malicious files. These hashes are unique to specific files, allowing quick identification of malware samples.</li>
<li>Example: Hash <code>d41d8cd98f00b204e9800998ecf8427e</code> matches a known malicious file.</li>
</ul>
</li>
<li>
<p><strong>Suspicious IP Addresses or Domains</strong>:</p>
<ul>
<li>IP addresses or domain names known to be associated with command-and-control (C2) servers used by attackers to communicate with compromised systems.</li>
<li>Example: An IP address or domain such as <code>malicious-c2.com</code> might indicate the system is connected to a threat actor.</li>
</ul>
</li>
<li>
<p><strong>Suspicious File Paths</strong>:</p>
<ul>
<li>Files stored in unusual directories or locations often used by malware to avoid detection.</li>
<li>Example: <code>C:\Users\Public\System32\drivers\svchost.exe</code> in a directory that is normally clean may raise suspicion.</li>
</ul>
</li>
<li>
<p><strong>Registry Keys</strong>:</p>
<ul>
<li>Abnormal or unexpected modifications to the Windows Registry that malware may use to establish persistence or manipulate system settings.</li>
<li>Example: A registry key set to run a suspicious program every time the system starts.</li>
</ul>
</li>
<li>
<p><strong>Unusual Network Activity</strong>:</p>
<ul>
<li>Unexplained outgoing connections to known malicious IP addresses, unexpected high levels of traffic, or suspicious protocols being used.</li>
<li>Example: A machine connecting to an IP address in a foreign country at unusual hours.</li>
</ul>
</li>
<li>
<p><strong>Executable Code Signatures</strong>:</p>
<ul>
<li>Executables with invalid or unknown digital signatures can be IoCs, indicating tampering or unauthorized modifications.</li>
<li>Example: A binary file with a signature mismatch that was altered by malware.</li>
</ul>
</li>
<li>
<p><strong>Suspicious Processes or Services</strong>:</p>
<ul>
<li>Processes or services running on a system that are unusual, unexpected, or match known malware behavior.</li>
<li>Example: A process named <code>randomsvc.exe</code> masquerading as a legitimate Windows service.</li>
</ul>
</li>
</ol>
<h3 id="why-are-iocs-important">Why Are IoCs Important?</h3>
<p>Simple IoCs serve as early warning signals that a security breach might have occurred. They allow organizations to:</p>
<ul>
<li><strong>Detect</strong> compromises in their environment before more damage is done.</li>
<li><strong>Investigate</strong> the nature of the attack by tracing these indicators back to their source.</li>
<li><strong>Respond</strong> and mitigate the threat quickly, stopping the attacker from causing further harm.</li>
</ul>
<h3 id="types-of-indicators-of-compromise">Types of Indicators of Compromise:</h3>
<p>While <strong>simple IoCs</strong> tend to be more specific and straightforward, such as file names or hashes, there are also more complex IoCs that include:</p>
<ul>
<li><strong>Behavioral IoCs</strong>: Patterns of actions or behaviors, such as lateral movement or privilege escalation.</li>
<li><strong>Tactical IoCs</strong>: Higher-level indicators that describe techniques, tactics, and procedures (TTPs) used by attackers.</li>
</ul>
<h2 id="neopi">NeoPI</h2>
<blockquote>
<p>NeoPI is a Python script that uses a variety of statistical methods to detect obfuscated and encrypted content within text/script files. The intended purpose of NeoPI is to aid in the detection of hidden web shell code. The development focus of NeoPI was creating a tool that could be used in conjunction with other established detection methods such as Linux Malware Detect or traditional signature/keyword based searches.</p>
</blockquote>
<h2 id="pepper">PEpper</h2>
<blockquote>
<p>checks some basic stuff inside the executable (binary data, entropy, URLs and IPs, some yara rules).</p>
</blockquote>
<pre><code>python pepper.py test.exe
</code></pre>
<h2 id="rkhunter">Rkhunter</h2>
<pre><code>sudo rkhunter --check
</code></pre>
<h2 id="chkrootkit">chkrootkit</h2>
<pre><code>sudo chkrootkit
</code></pre>
<h2 id="maldet">Maldet</h2>
<pre><code>sudo maldet -a /
</code></pre>
<pre><code>sudo maldet -a /home/koosha/Dowmloads
</code></pre>
<blockquote>
<p>-c, –checkout FILE  : This command will upload suspected malware to <a href="http://rfxn.com">rfxn.com</a> for review &amp; hashing into signatures</p>
</blockquote>
<pre><code>sudo maldet -c /home/koosha/Downloads/malware.ml
</code></pre>
<blockquote>
<p>-l, –log : This command will view maldet log file events.</p>
</blockquote>
<pre><code>maldet -l
</code></pre>
<blockquote>
<p>Check your Scan Results from Maldet</p>
</blockquote>
<pre><code>maldet -report &lt;SCAN-ID&gt;
</code></pre>
<blockquote>
<p>Remove all detected Malware based on a Scan Report</p>
</blockquote>
<pre><code>maldet -quarantine &lt;SCAN-ID&gt;
</code></pre>
<pre><code>maldet –quarantine 08594-19634.85478
</code></pre>
<blockquote>
<p>Restoring a File you accidentally removed with Maldet</p>
</blockquote>
<pre><code>maldet -restore Folder/File
</code></pre>
<hr>
<blockquote>
<p>Update Maldet database</p>
</blockquote>
<pre><code>sudo maldet -u
</code></pre>
<blockquote>
<p>upgrade maldet installation version</p>
</blockquote>
<pre><code>maldet -d
</code></pre>
<h2 id="radare2">radare2</h2>
<h1 id="radare2-1">Radare2</h1>
<p>Radare2 (r2) is a highly versatile tool that can do everything from reverse engineering and analyzing malware to debugging, patching, and disassembling binaries. Here’s more in-depth information to extend your understanding of Radare2, including its advanced commands, scripting capabilities, and use cases.</p>
<hr>
<h3 id="file-analysis-in-radare2">1. <strong>File Analysis in Radare2</strong></h3>
<p>Radare2 allows you to inspect various parts of a binary or a file, such as the file format, sections, segments, and more. This helps you understand the structure of a binary and how it operates.</p>
<h4 id="basic-file-analysis-commands"><strong>Basic File Analysis Commands</strong></h4>
<ul>
<li>
<p><strong>File Header Information:</strong></p>
<pre class=" language-bash"><code class="prism  language-bash">iI
</code></pre>
<p>This shows general information like file type, architecture, and entry point.</p>
</li>
<li>
<p><strong>File Sections:</strong></p>
<pre class=" language-bash"><code class="prism  language-bash">iS
</code></pre>
<p>Displays the various sections in the binary like <code>.text</code>, <code>.data</code>, <code>.bss</code>, etc.</p>
</li>
<li>
<p><strong>File Symbols:</strong></p>
<ul>
<li>Imports: <code>ii</code></li>
<li>Exports: <code>iE</code></li>
<li>Functions: <code>afl</code></li>
</ul>
</li>
</ul>
<h4 id="analyze-all-at-once"><strong>Analyze All at Once</strong></h4>
<p>If you want to perform a full analysis on the binary (functions, symbols, strings):</p>
<pre class=" language-bash"><code class="prism  language-bash">aaa
</code></pre>
<p>This is a more comprehensive version of the <code>aa</code> command, which provides deeper insights into function boundaries, basic blocks, and control flow.</p>
<hr>
<h3 id="exploring-functions-and-disassembly">2. <strong>Exploring Functions and Disassembly</strong></h3>
<p>Radare2 provides a rich set of commands to analyze and explore functions within a binary.</p>
<h4 id="view-functions-in-the-binary"><strong>View Functions in the Binary</strong></h4>
<ul>
<li>
<p><strong>List all functions:</strong></p>
<pre class=" language-bash"><code class="prism  language-bash">afl
</code></pre>
<p>Each function will be displayed with its address, size, and name.</p>
</li>
<li>
<p><strong>Disassemble Function:</strong></p>
<pre class=" language-bash"><code class="prism  language-bash">pdf @ <span class="token operator">&lt;</span>address<span class="token operator">&gt;</span>
</code></pre>
<p>This disassembles a function at a specific address, showing instructions line by line.</p>
</li>
<li>
<p><strong>View Graph of a Function:</strong></p>
<pre class=" language-bash"><code class="prism  language-bash">agf @ <span class="token operator">&lt;</span>function_address<span class="token operator">&gt;</span>
</code></pre>
<p>Radare2 will output a textual representation of a function’s control flow graph (CFG). Use Cutter (Radare2’s GUI) for a graphical representation.</p>
</li>
</ul>
<hr>
<h3 id="control-flow-graphs-and-basic-blocks">3. <strong>Control Flow Graphs and Basic Blocks</strong></h3>
<p>A control flow graph (CFG) represents all possible paths that a program can take through its code. Basic blocks (single-entry, single-exit blocks of code) are the fundamental units within these graphs.</p>
<h4 id="cfg-commands"><strong>CFG Commands</strong></h4>
<ul>
<li><strong>View control flow graph:</strong> In visual mode, press <code>V</code> to see the control flow graph.</li>
<li><strong>List basic blocks in a function:</strong><pre class=" language-bash"><code class="prism  language-bash">afb @ <span class="token operator">&lt;</span>function_address<span class="token operator">&gt;</span>
</code></pre>
</li>
</ul>
<h4 id="analyze-function’s-control-flow"><strong>Analyze function’s control flow:</strong></h4>
<ul>
<li>To get details on how a function branches, loops, and calls other functions:<pre class=" language-bash"><code class="prism  language-bash">afcf @ <span class="token operator">&lt;</span>function_address<span class="token operator">&gt;</span>
</code></pre>
</li>
</ul>
<hr>
<h3 id="scripting-and-automation-in-radare2">4. <strong>Scripting and Automation in Radare2</strong></h3>
<p>Radare2 is scriptable, allowing users to automate repetitive tasks or perform advanced analysis through custom scripts. You can execute sequences of Radare2 commands via a script.</p>
<h4 id="creating-and-running-a-script"><strong>Creating and Running a Script</strong></h4>
<p>Create a text file <code>script.r2</code> with Radare2 commands:</p>
<pre class=" language-bash"><code class="prism  language-bash">aa
pdf @ main
</code></pre>
<p>Run the script:</p>
<pre class=" language-bash"><code class="prism  language-bash">r2 -i script.r2 <span class="token operator">&lt;</span>binary_file<span class="token operator">&gt;</span>
</code></pre>
<p>This automates the process of analyzing the binary and disassembling the <code>main</code> function.</p>
<h4 id="embedded-scripting-languages"><strong>Embedded Scripting Languages</strong></h4>
<p>Radare2 supports scripting with Python, Lua, or r2pipe, a library that can interface with Radare2 from external programs.</p>
<p>For example, using r2pipe in Python:</p>
<pre class=" language-python"><code class="prism  language-python"><span class="token keyword">import</span> r2pipe
r2 <span class="token operator">=</span> r2pipe<span class="token punctuation">.</span><span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">"/bin/ls"</span><span class="token punctuation">)</span>
r2<span class="token punctuation">.</span>cmd<span class="token punctuation">(</span><span class="token string">"aa"</span><span class="token punctuation">)</span>
functions <span class="token operator">=</span> r2<span class="token punctuation">.</span>cmd<span class="token punctuation">(</span><span class="token string">"afl"</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>functions<span class="token punctuation">)</span>
</code></pre>
<hr>
<h3 id="binary-patching-with-radare2">5. <strong>Binary Patching with Radare2</strong></h3>
<p>Radare2 allows you to modify (patch) binaries directly. You can inject or modify machine code, change program behavior, or patch security vulnerabilities.</p>
<h4 id="patch-instructions"><strong>Patch Instructions</strong></h4>
<ul>
<li>
<p><strong>Patch with an Assembly instruction:</strong></p>
<pre class=" language-bash"><code class="prism  language-bash">wa <span class="token operator">&lt;</span>instruction<span class="token operator">&gt;</span> @ <span class="token operator">&lt;</span>address<span class="token operator">&gt;</span>
</code></pre>
<p>Example:</p>
<pre class=" language-bash"><code class="prism  language-bash">wa nop @ 0x08048450
</code></pre>
</li>
<li>
<p><strong>Patch with raw bytes:</strong></p>
<pre class=" language-bash"><code class="prism  language-bash">wx <span class="token operator">&lt;</span>hex_bytes<span class="token operator">&gt;</span> @ <span class="token operator">&lt;</span>address<span class="token operator">&gt;</span>
</code></pre>
<p>Example:</p>
<pre class=" language-bash"><code class="prism  language-bash">wx 909090 @ 0x08048450   <span class="token comment"># Write 3 NOP instructions</span>
</code></pre>
</li>
<li>
<p><strong>Save changes:</strong><br>
After modifying the binary, save it with:</p>
<pre class=" language-bash"><code class="prism  language-bash">w
q
</code></pre>
</li>
</ul>
<hr>
<h3 id="debugging-with-radare2">6. <strong>Debugging with Radare2</strong></h3>
<p>You can debug live applications or examine core dumps with Radare2. The debugging mode offers breakpoints, stepping, inspecting memory, and more.</p>
<h4 id="start-debugging"><strong>Start Debugging</strong></h4>
<pre class=" language-bash"><code class="prism  language-bash">r2 -d ./binary
</code></pre>
<h4 id="set-and-manage-breakpoints"><strong>Set and Manage Breakpoints</strong></h4>
<ul>
<li>
<p><strong>Set breakpoint:</strong></p>
<pre class=" language-bash"><code class="prism  language-bash">db <span class="token operator">&lt;</span>address<span class="token operator">&gt;</span>
</code></pre>
<p>Example:</p>
<pre class=" language-bash"><code class="prism  language-bash">db main
</code></pre>
</li>
<li>
<p><strong>List breakpoints:</strong></p>
<pre class=" language-bash"><code class="prism  language-bash">db
</code></pre>
</li>
</ul>
<h4 id="execution-controls"><strong>Execution Controls</strong></h4>
<ul>
<li>
<p><strong>Continue execution:</strong></p>
<pre class=" language-bash"><code class="prism  language-bash"><span class="token function">dc</span>
</code></pre>
</li>
<li>
<p><strong>Step into an instruction:</strong></p>
<pre class=" language-bash"><code class="prism  language-bash">ds
</code></pre>
</li>
<li>
<p><strong>Step over:</strong></p>
<pre class=" language-bash"><code class="prism  language-bash">dso
</code></pre>
</li>
</ul>
<h4 id="inspecting-registers-memory-and-stack"><strong>Inspecting Registers, Memory, and Stack</strong></h4>
<ul>
<li>
<p><strong>View registers:</strong></p>
<pre class=" language-bash"><code class="prism  language-bash">dr
</code></pre>
</li>
<li>
<p><strong>View memory:</strong></p>
<pre class=" language-bash"><code class="prism  language-bash">x @ <span class="token operator">&lt;</span>address<span class="token operator">&gt;</span>
</code></pre>
<p>Example:</p>
<pre class=" language-bash"><code class="prism  language-bash">px 32 @ rsp   <span class="token comment"># View 32 bytes at the stack pointer</span>
</code></pre>
</li>
</ul>
<hr>
<h3 id="working-with-strings-and-references">7. <strong>Working with Strings and References</strong></h3>
<p>Radare2 can help you extract strings and find code references to specific functions or addresses, which is essential for analyzing malware or proprietary binaries.</p>
<h4 id="extract-strings"><strong>Extract Strings</strong></h4>
<p>To find strings within the binary (e.g., for format strings or error messages):</p>
<pre class=" language-bash"><code class="prism  language-bash">iz
</code></pre>
<h4 id="find-code-references"><strong>Find Code References</strong></h4>
<ul>
<li>
<p><strong>Find cross-references to a function or address:</strong></p>
<pre class=" language-bash"><code class="prism  language-bash">axt @ <span class="token operator">&lt;</span>address<span class="token operator">&gt;</span>
</code></pre>
</li>
<li>
<p><strong>Find all the locations where a function is called:</strong></p>
<pre class=" language-bash"><code class="prism  language-bash">axt @ sym.main
</code></pre>
</li>
</ul>
<hr>
<h3 id="visual-mode-in-radare2">8. <strong>Visual Mode in Radare2</strong></h3>
<p>Radare2 has a powerful “Visual Mode,” which is helpful for disassembling, analyzing control flow, and browsing the binary interactively.</p>
<h4 id="enter-visual-mode"><strong>Enter Visual Mode</strong></h4>
<p>To enter visual mode, type:</p>
<pre class=" language-bash"><code class="prism  language-bash">V
</code></pre>
<h4 id="views-in-visual-mode"><strong>Views in Visual Mode</strong></h4>
<ul>
<li><strong>Disassembly view:</strong> <code>p</code> then <code>d</code></li>
<li><strong>Hexdump view:</strong> <code>p</code> then <code>x</code></li>
<li><strong>Graph view:</strong> Press <code>V</code> again to visualize the control flow graph (CFG).</li>
</ul>
<p>You can navigate through the disassembly or CFG using the arrow keys.</p>
<h4 id="change-display-themes"><strong>Change Display Themes</strong></h4>
<p>Change the theme in visual mode:</p>
<pre class=" language-bash"><code class="prism  language-bash">e scr.color<span class="token operator">=</span>3   <span class="token comment"># Enable theme colors</span>
</code></pre>
<hr>
<h3 id="advanced-analysis">9. <strong>Advanced Analysis</strong></h3>
<p>Radare2 can perform deeper binary analysis, which includes reconstructing control flow, analyzing the program’s structure, and even emulating the program.</p>
<h4 id="advanced-analysis-commands"><strong>Advanced Analysis Commands</strong></h4>
<ul>
<li>
<p><strong>Function arguments and locals:</strong></p>
<pre class=" language-bash"><code class="prism  language-bash">afv
</code></pre>
<p>This command lists function arguments and local variables.</p>
</li>
<li>
<p><strong>Stack layout of a function:</strong></p>
<pre class=" language-bash"><code class="prism  language-bash">afS
</code></pre>
</li>
<li>
<p><strong>Emulation (Simulate program execution):</strong></p>
<pre class=" language-bash"><code class="prism  language-bash">aei    <span class="token comment"># Enable emulation</span>
aeip   <span class="token comment"># Emulate one instruction</span>
</code></pre>
</li>
</ul>
<h4 id="symbolic-execution"><strong>Symbolic Execution</strong></h4>
<p>Radare2 supports symbolic execution via plugins like <code>ESIL</code>, which allows you to simulate the execution of binary code. This is helpful for tracing paths, checking registers, or evaluating program behavior without actually running the code.</p>
<ul>
<li>
<p><strong>Enable ESIL emulation:</strong></p>
<pre class=" language-bash"><code class="prism  language-bash">aeim   <span class="token comment"># Initialize memory for ESIL</span>
</code></pre>
</li>
<li>
<p><strong>Set ESIL registers and step:</strong></p>
<pre class=" language-bash"><code class="prism  language-bash">aeim
aeip
</code></pre>
</li>
</ul>
<h1 id="radare2-extended-commands">Radare2 Extended Commands</h1>
<p>Radare2 (r2) is a powerful tool that can handle reverse engineering, binary patching, malware analysis, and much more. Below is a more extensive set of commands and use cases, with examples to guide you through various tasks.</p>
<hr>
<h3 id="basic-file-analysis-and-exploration">1. <strong>Basic File Analysis and Exploration</strong></h3>
<ul>
<li>
<p><strong>Analyze Binary Structure</strong></p>
<pre class=" language-bash"><code class="prism  language-bash">r2 <span class="token operator">&lt;</span>binary_file<span class="token operator">&gt;</span>
aa  <span class="token comment"># Analyze binary</span>
</code></pre>
<p>Example:</p>
<pre class=" language-bash"><code class="prism  language-bash">r2 /bin/ls
aa
</code></pre>
</li>
<li>
<p><strong>List Strings in a Binary</strong></p>
<pre class=" language-bash"><code class="prism  language-bash">iz
</code></pre>
<p>Example:</p>
<pre class=" language-bash"><code class="prism  language-bash">iz <span class="token operator">|</span> <span class="token function">grep</span> <span class="token string">"error"</span>  <span class="token comment"># Find strings related to "error"</span>
</code></pre>
</li>
<li>
<p><strong>Inspect Hexdump</strong></p>
<pre class=" language-bash"><code class="prism  language-bash">px <span class="token operator">&lt;</span>number_of_bytes<span class="token operator">&gt;</span> @ <span class="token operator">&lt;</span>address<span class="token operator">&gt;</span>
</code></pre>
<p>Example:</p>
<pre class=" language-bash"><code class="prism  language-bash">px 64 @ 0x00400000
</code></pre>
</li>
</ul>
<hr>
<h3 id="function-analysis-and-disassembly">2. <strong>Function Analysis and Disassembly</strong></h3>
<ul>
<li>
<p><strong>List All Functions</strong></p>
<pre class=" language-bash"><code class="prism  language-bash">afl
</code></pre>
<p>Example:</p>
<pre class=" language-bash"><code class="prism  language-bash">afl <span class="token operator">|</span> <span class="token function">grep</span> main  <span class="token comment"># Search for main function</span>
</code></pre>
</li>
<li>
<p><strong>Disassemble Function</strong></p>
<pre class=" language-bash"><code class="prism  language-bash">pdf @ <span class="token operator">&lt;</span>function_address<span class="token operator">&gt;</span>
</code></pre>
<p>Example:</p>
<pre class=" language-bash"><code class="prism  language-bash">pdf @ sym.main
</code></pre>
</li>
<li>
<p><strong>Control Flow Graph (CFG) in Visual Mode</strong></p>
<pre class=" language-bash"><code class="prism  language-bash">V   <span class="token comment"># Enter visual mode</span>
V   <span class="token comment"># Toggle control flow graph</span>
</code></pre>
</li>
</ul>
<hr>
<h3 id="patching-and-modifying-binaries">3. <strong>Patching and Modifying Binaries</strong></h3>
<ul>
<li>
<p><strong>Patch a Single Instruction</strong></p>
<pre class=" language-bash"><code class="prism  language-bash">wa <span class="token operator">&lt;</span>assembly_instruction<span class="token operator">&gt;</span> @ <span class="token operator">&lt;</span>address<span class="token operator">&gt;</span>
</code></pre>
<p>Example:</p>
<pre class=" language-bash"><code class="prism  language-bash">wa xor eax, eax @ 0x0804845a
</code></pre>
</li>
<li>
<p><strong>Patch with Raw Bytes</strong></p>
<pre class=" language-bash"><code class="prism  language-bash">wx <span class="token operator">&lt;</span>hex_bytes<span class="token operator">&gt;</span> @ <span class="token operator">&lt;</span>address<span class="token operator">&gt;</span>
</code></pre>
<p>Example:</p>
<pre class=" language-bash"><code class="prism  language-bash">wx 909090 @ 0x0804845a  <span class="token comment"># Write 3 NOPs at the specified address</span>
</code></pre>
</li>
<li>
<p><strong>Save and Exit</strong></p>
<pre class=" language-bash"><code class="prism  language-bash">wq
</code></pre>
</li>
</ul>
<hr>
<h3 id="debugging">4. <strong>Debugging</strong></h3>
<ul>
<li>
<p><strong>Start Debugging a Binary</strong></p>
<pre class=" language-bash"><code class="prism  language-bash">r2 -d <span class="token operator">&lt;</span>binary_file<span class="token operator">&gt;</span>
</code></pre>
<p>Example:</p>
<pre class=" language-bash"><code class="prism  language-bash">r2 -d ./a.out
</code></pre>
</li>
<li>
<p><strong>Set Breakpoint</strong></p>
<pre class=" language-bash"><code class="prism  language-bash">db <span class="token operator">&lt;</span>address<span class="token operator">&gt;</span>
</code></pre>
<p>Example:</p>
<pre class=" language-bash"><code class="prism  language-bash">db 0x0804845a  <span class="token comment"># Set a breakpoint at a specific address</span>
</code></pre>
</li>
<li>
<p><strong>Continue Execution</strong></p>
<pre class=" language-bash"><code class="prism  language-bash"><span class="token function">dc</span>
</code></pre>
</li>
<li>
<p><strong>Inspect Registers</strong></p>
<pre class=" language-bash"><code class="prism  language-bash">dr
</code></pre>
</li>
</ul>
<hr>
<h3 id="memory-inspection-and-manipulation">5. <strong>Memory Inspection and Manipulation</strong></h3>
<ul>
<li>
<p><strong>Inspect Stack Memory</strong></p>
<pre class=" language-bash"><code class="prism  language-bash">px 32 @ rsp   <span class="token comment"># View 32 bytes from the stack pointer</span>
</code></pre>
</li>
<li>
<p><strong>Dump Memory to a File</strong></p>
<pre class=" language-bash"><code class="prism  language-bash">wtf <span class="token operator">&lt;</span>output_file<span class="token operator">&gt;</span> @ <span class="token operator">&lt;</span>address<span class="token operator">&gt;</span>
</code></pre>
<p>Example:</p>
<pre class=" language-bash"><code class="prism  language-bash">wtf dump.bin @ 0x00400000  <span class="token comment"># Dump memory to a file</span>
</code></pre>
</li>
<li>
<p><strong>Search for Specific Data in Memory</strong></p>
<pre class=" language-bash"><code class="prism  language-bash">/x <span class="token operator">&lt;</span>hex_value<span class="token operator">&gt;</span>
</code></pre>
<p>Example:</p>
<pre class=" language-bash"><code class="prism  language-bash">/x 48b8    <span class="token comment"># Search for hex 0x48b8</span>
</code></pre>
</li>
</ul>
<hr>
<h3 id="symbolic-execution-and-emulation">6. <strong>Symbolic Execution and Emulation</strong></h3>
<ul>
<li>
<p><strong>Enable Emulation</strong></p>
<pre class=" language-bash"><code class="prism  language-bash">aei   <span class="token comment"># Enable ESIL (Emulation)</span>
aeim  <span class="token comment"># Initialize memory for ESIL</span>
aeip  <span class="token comment"># Step through one instruction</span>
</code></pre>
<p>Example:</p>
<pre class=" language-bash"><code class="prism  language-bash">aeim
aeip  <span class="token comment"># Execute one instruction using symbolic execution</span>
</code></pre>
</li>
<li>
<p><strong>Check ESIL Registers</strong></p>
<pre class=" language-bash"><code class="prism  language-bash">aer
</code></pre>
</li>
</ul>
<hr>
<h3 id="scripting-and-automation">7. <strong>Scripting and Automation</strong></h3>
<ul>
<li>
<p><strong>Run Script</strong><br>
Create a script <code>script.r2</code>:</p>
<pre class=" language-bash"><code class="prism  language-bash">aa
pdf @ sym.main
</code></pre>
<p>Run the script:</p>
<pre class=" language-bash"><code class="prism  language-bash">r2 -i script.r2 <span class="token operator">&lt;</span>binary_file<span class="token operator">&gt;</span>
</code></pre>
</li>
<li>
<p><strong>Using Python with r2pipe</strong></p>
<pre class=" language-python"><code class="prism  language-python"><span class="token keyword">import</span> r2pipe
r2 <span class="token operator">=</span> r2pipe<span class="token punctuation">.</span><span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">"/bin/ls"</span><span class="token punctuation">)</span>
r2<span class="token punctuation">.</span>cmd<span class="token punctuation">(</span><span class="token string">"aa"</span><span class="token punctuation">)</span>
functions <span class="token operator">=</span> r2<span class="token punctuation">.</span>cmd<span class="token punctuation">(</span><span class="token string">"afl"</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>functions<span class="token punctuation">)</span>
</code></pre>
</li>
</ul>
<hr>
<h3 id="advanced-disassembly-and-control-flow">8. <strong>Advanced Disassembly and Control Flow</strong></h3>
<ul>
<li>
<p><strong>Disassemble in Visual Mode</strong></p>
<pre class=" language-bash"><code class="prism  language-bash">V
pd @ <span class="token operator">&lt;</span>address<span class="token operator">&gt;</span>
</code></pre>
<p>Example:</p>
<pre class=" language-bash"><code class="prism  language-bash">pd @ 0x08048450
</code></pre>
</li>
<li>
<p><strong>View Function’s Control Flow Graph</strong></p>
<pre class=" language-bash"><code class="prism  language-bash">agf @ <span class="token operator">&lt;</span>function_address<span class="token operator">&gt;</span>
</code></pre>
<p>Example:</p>
<pre class=" language-bash"><code class="prism  language-bash">agf @ sym.main
</code></pre>
</li>
<li>
<p><strong>Analyze Function Variables and Stack</strong></p>
<pre class=" language-bash"><code class="prism  language-bash">afv   <span class="token comment"># Analyze function variables</span>
afS   <span class="token comment"># Analyze function stack</span>
</code></pre>
</li>
</ul>
<hr>
<h3 id="finding-and-analyzing-references">9. <strong>Finding and Analyzing References</strong></h3>
<ul>
<li>
<p><strong>Find All Code References</strong></p>
<pre class=" language-bash"><code class="prism  language-bash">axt @ <span class="token operator">&lt;</span>address<span class="token operator">&gt;</span>
</code></pre>
<p>Example:</p>
<pre class=" language-bash"><code class="prism  language-bash">axt @ sym.main  <span class="token comment"># Find all references to 'main'</span>
</code></pre>
</li>
<li>
<p><strong>Find Function Calls</strong></p>
<pre class=" language-bash"><code class="prism  language-bash">axtj @ sym.main
</code></pre>
</li>
<li>
<p><strong>Find Data Cross-References</strong></p>
<pre class=" language-bash"><code class="prism  language-bash">axtd @ <span class="token operator">&lt;</span>address<span class="token operator">&gt;</span>
</code></pre>
</li>
</ul>
<hr>
<h3 id="visual-mode-enhancements">10. <strong>Visual Mode Enhancements</strong></h3>
<ul>
<li>
<p><strong>Enable Color Themes</strong></p>
<pre class=" language-bash"><code class="prism  language-bash">e scr.color<span class="token operator">=</span>3  <span class="token comment"># Enable visual mode color theme</span>
</code></pre>
</li>
<li>
<p><strong>Switch Between Views in Visual Mode</strong></p>
<ul>
<li>Disassembly: <code>p</code> then <code>d</code></li>
<li>Hexdump: <code>p</code> then <code>x</code></li>
<li>Control Flow: <code>V</code></li>
</ul>
</li>
</ul>
<hr>
<h2 id="ghidra">Ghidra</h2>
<h2 id="online-tools">online Tools</h2>
<p>1 - <a href="https://any.run/">https://any.run/</a><br>
2 - <a href="https://analyze.intezer.com/">https://analyze.intezer.com/</a><br>
3 - <a href="https://koodous.com/">https://koodous.com/</a><br>
4 - <a href="https://www.hybrid-analysis.com/">https://www.hybrid-analysis.com/</a><br>
5 - <a href="https://www.virustotal.com/gui/home/upload">https://www.virustotal.com/gui/home/upload</a></p>
</div>
</body>

</html>
